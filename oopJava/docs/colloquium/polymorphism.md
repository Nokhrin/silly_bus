# Полиморфизм

## Аксиоматическое определение
Свойство объектной модели
осуществлять выбор реализации функции с единой сигнатурой, 
осуществляемый средой выполнения в runtime 
на основе динамического типа объекта, 
получающего результат вычисления функции
реализуемое средствами языка программирования 

## Прагматическое определение
Свойство объектной модели Java
реализуемое посредством интерфейсов и таблиц виртуальных методов
выполняемой средой выполнения (jvm) 
в runtime
и заключающееся в выборе получателя вызова метода
на основе динамического типа получателя

Пример
есть метод с единой сигнатурой, есть множество классов, реализующих метод
выбор реализации - в runtime

Контрпример
статический выбор реализации в compile
условная логика - нет динамической типизации


## Выигрыш
- упрощение соблюдения требований к состоянию и поведению объекта
- добавление нового типа не приводит к перекомпиляции существующих классов
- избежать модификации существующего кода класса/метода при изменении логики (старое не меняем)
- новый код расширяет существующий класс/тип (добавляем интерфейс)

Пример 1
Полиморфное поведение с помощью статической проверки if + isinstance в конструкторе класса
меняется задача/логика - например, добавляется подтип - +проверка в if => дублирование, риск забыть проверку, опечататься

Пример 2
Полиморфное поведение с помощью статической проверки / подтиповой полиморфизм
if + isinstance для выбора реализации => копилируется прямой вызов
Для каждого типа реализован метод  обработки с уникальным именем - когнитивная нагрузка поддержки имен методов
Риск ошибки при разработке - опечатка, не тот метод с похожим названием

Контрпример


Проигрыш
Расходы на косенный вызов из vtable 

Контрпример
- поиск vtable - константное время


## Связь с ООП сущностями
abstraction
полиморфизм применим в пределах созданной абстракции - предусмотрено то, что явно описано, т.е. контракт

[пример - площадь фигур](../../concepts/src/main/java/org/example/polymorphism/shapes/ShapeMain.java)
в задаче имеют значения величины, необходимые для расчета площади
не имеют значения => не включаются в модель/класс: тип линии, размер точки, координаты центра фигуры

api-контракт: для получения площади фигуры типа Квадрат передай длину стороны
пользователь: дан квадрат со стороной 5, верни площадь этого квадрата
api-контракт: площадь квадрата со стороной 5

пользователя интересует результат - площадь фигуры; пользователя не интересует прочее, например, методика определения типа и выполнения расчета
определение реализации - проявление полиморфизма
процедура определения может быть запрограммирована множеством способов

---

ocp
полиморфизм - инструмент соблюдения принципа открытости/закрытости (open/close principle | ocp)
проявляется в добавлении функционала (расширении класса) с помощью создания интерфейсов - старое не трогаем, добавляем новое

[соответствие OCP](../../concepts/src/main/java/org/example/polymorphism/shapes/AreasManagerNoOcp.java)
[нарушение OCP](../../concepts/src/main/java/org/example/polymorphism/shapes/AreasManagerOcp.java)


---

Пример в коде
Задача - выбор сериализатора
[Динамический выбор / Полиморфизм](../../concepts/src/main/java/org/example/polymorphism/serializables/SerializableDynamic.java)
[Статический выбор / НеПолиморфизм](../../concepts/src/main/java/org/example/polymorphism/serializables/SerializableStatic.java)


---

## Решение о применении
- раз в неделю добавляется подтип
- стабильность и удобство приоритетнее производительности

- один новый подтип добавляется 1 раз в год
- критичны расходы (микросекунды) на динамическую диспетчеризацию

---

### рассуждения на полях

полиморфизм
не процесс, т.к. процесс имеет начало, переходы, завершение
не механизм, т.к. механизмом может быть физический объект, каким не является полиморфизм

свойство, т.к. может быть реализован / не реализован, может применяться / не применяться

полиморфизм - результат использования интерфейсов и наследования? - интерфейсы и наследование - один из способов реализации полиморфизма
полиморфизм можно применять, можно не применять

есть код, который умеет рисовать Круг. Появляется задача рисовать Квадрат.
Без полиморфизма: в класс рисовальщика добавить метод рисования квадрата, с помощью if выбирать выполнение этого метода, если на вход передано "нарисуй квадрат"  
С полиморфизмом: добавить класс квадрата, переопределяющий метод рисования так, чтобы получился квадрат

---