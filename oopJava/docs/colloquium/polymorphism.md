# Полиморфизм  
  
## Аксиоматическое определение | Что это?  
Свойство объектной модели  
осуществлять выбор реализации функции с единой сигнатурой,   
осуществляемый средой выполнения в runtime   
на основе динамического типа объекта,   
получающего результат вычисления функции  
реализуемое средствами языка программирования   
  
## Прагматическое определение | Зачем? | Чем это может быть полезно?  
  
с полиморфизмом и без полиморфизма выполняется работа:  
`определить тип объекта -> определить метод объекта`  
  
полиморфизм абстрагирует от этих рутинных шагов - "выносит за скобки" в интерфейс  
[пример интерфейса](../../concepts/src/main/java/org/example/polymorphism/shapes/IShapeCalculator.java)  
  
в результате "рутинная" логика сохраняется, но не забирает на себя внимание  
=> снижает когнитивные расходы на обслуживание кода  
=> освобождает ресурс для решения сути задачи  
  
  
проявляется в добавлении функционала (расширении класса) с помощью создания интерфейсов - старое не трогаем, добавляем новое  
#### пример  
площадь получаю методом getSquare для **любой фигуры (типа объекта - именно, поддтипа Shape)**  
выбор реализации по динамическому типу объекта - в runtime  
[Полиморфизм](../../concepts/src/main/java/org/example/polymorphism/shapes/AreasManagerPoly.java)  
  
#### контрпример  
площадь получаю определением типа фигуры, по типу фигуры выбираю метод расчета площади  
статический выбор реализации в compile  
[НеПолиморфизм](../../concepts/src/main/java/org/example/polymorphism/shapes/AreasManagerNoPoly.java)  
  
  
  
  
  
### Классификация и Признаки полиморфизма  
  
не процесс, т.к. процесс имеет начало, переходы, завершение  
не механизм, т.к. механизмом может быть физический объект, каким не является полиморфизм  
  
свойство, т.к. может быть реализован / не реализован, может применяться / не применяться  
  
результат использования интерфейсов и наследования? - интерфейсы и наследование - один из способов реализации полиморфизма  
  
есть код, который умеет рисовать Круг. Появляется задача рисовать Квадрат.  
Без полиморфизма: в класс рисовальщика добавить метод рисования квадрата, с помощью if выбирать выполнение этого метода, если на вход передано "нарисуй квадрат"    
С полиморфизмом: добавить класс квадрата, переопределяющий метод рисования так, чтобы получился квадрат  
  
  
## Выигрыш  
- контроль поведения объекта в одном классе / интерфейсе  
  
### добавление нового типа не приводит к перекомпиляции существующих классов  
  
Задача - выбор сериализатора  
#### пример  
для добавления сериализации нового формата создаю **новый класс**, не трогаю существующие *.class  
[Динамический выбор / Полиморфизм](../../concepts/src/main/java/org/example/polymorphism/serializables/SerializableDynamic.java)  
  
#### контрпример  
для добавления сериализации нового формата создаю меняю **существующий класс**, необходимо перекомпилировать систему  
[Статический выбор / НеПолиморфизм](../../concepts/src/main/java/org/example/polymorphism/serializables/SerializableStatic.java)  
  
  
  
- избежать модификации существующего кода класса/метода при изменении логики (старое не меняем)  
- новый код расширяет существующий класс/тип (добавляем интерфейс)  
  
## Проигрыш  
Расходы на косвенный вызов из vtable   
  
Контрпример  
- поиск vtable - константное время  
  
  
  
## Связь с ООП сущностями  
  
### abstraction  
полиморфизм применим в пределах созданной абстракции - предусмотрено то, что явно описано, т.е. контракт  
  
[пример - площадь фигур](../../concepts/src/main/java/org/example/polymorphism/shapes/ShapeMain.java)  
в задаче имеют значения величины, необходимые для расчета площади  
не имеют значения => не включаются в модель/класс: тип линии, размер точки, координаты центра фигуры  
  
api-контракт: для получения площади фигуры типа Квадрат передай длину стороны  
пользователь: дан квадрат со стороной 5, верни площадь этого квадрата  
api-контракт: площадь квадрата со стороной 5  
  
пользователя интересует результат - площадь фигуры;   
пользователя не интересует прочее, например, методика определения типа и выполнения расчета  
  
определение реализации - проявление полиморфизма  
процедура определения может быть запрограммирована множеством способов  
- статически - проверкой instanceof  
- динамически - созданием vtable  
- динамически - рефлексивно ???  
  
---  
  
# OCP  
  
## Аксиоматическое определение | Что это?  
Обеспечение свойства модели добавить функциональность без внесения изменений в существующую реализацию  
  
  
## Прагматическое определение | Зачем? | Чем это может быть полезно?  
Скомпилированные файлы не должны требовать замены  
Расширение - буквально - добавление нового файла `*.class` (в нем новый функционал | расширение), который применяется существующими `*.class`  
  
  
### рассуждения  
есть система управления банковскими операциями  
существует `BankOperationOCP.class`  
пользователь, чья задача -   
получение на вход последовательности операций,  
последовательная обработка операций по FIFO,  
валидация операции,  
при успехе валидации - выполнение операции  
при провале валидации - отклонение операции  
  
существует ``  
  
если принять за истину `Скомпилированные файлы не должны требовать замены`  
каким образом старый *.class узнает о новом без изменения и перекомпиляции?  
гипотеза: исполь  
  
Расширение функционала - в новом java файле?  
Добавление метода в существующий интерфейс изменит исходный код и потребует перекомпиляции - это нарушение OCP?  
  
Есть сущность A, представленная в коде  
Для сущности написана логика  
oopJava/concepts/src/main/java/org/example/polymorphism/payments/AccountOCP_1.java  
  
Сущность применяется во внешнем коде  
  
  
Код, содержащий повторяющиеся блоки код  
  
полиморфизм - инструмент соблюдения принципа открытости/закрытости (open/closed principle | ocp)  
  
  
  
---  
  
## Решение о применении  
- раз в неделю добавляется подтип  
- стабильность и удобство приоритетнее производительности  
  
- один новый подтип добавляется 1 раз в год  
- критичны расходы (микросекунды) на динамическую диспетчеризацию  
  
  
  
---  