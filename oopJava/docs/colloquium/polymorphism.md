# Полиморфизм

## Аксиоматическое определение
Выбор реализации метода с единой сигнатурой, осуществляемый средой выполнения в runtime на основе динамического типа объекта


## Прагматическое определение

## Существенные признаки
- выполняется кодом среды выполнения (jvm)
- выполняется в runtime
- единая точка вызова (сигнатура метода: имя метода + параметры) - один метод для разных подтипов
- выбор на основе динамического типа получателя вызова
- Усиление абстракции - множество реализаций внутри класса, извне доступен универсальный интерфейс

Пример
есть метод с единой сигнатурой, есть множество классов, реализующих метод
выбор реализации - в runtime

Контрпример
статический выбор реализации в compile
условная логика - нет динамической типизации


## Выигрыш
- избежать модификации существующего кода класса/метода при изменении логики
- новый код расширяет существующий класс/тип

Пример 1
Полиморфное поведение с помощью статической проверки if + isinstance в конструкторе класса
меняется задача/логика - например, добавляется подтип - +проверка в if => дублирование, риск забыть проверку, опечататься

Пример 2
Полиморфное поведение с помощью статической проверки / подтиповой полиморфизм
if + isinstance для выбора реализации => копилируется прямой вызов
Для каждого типа реализован метод  обработки с уникальным именем - когнитивная нагрузка поддержки имен методов
Риск ошибки при разработке - опечатка, не тот метод с похожим названием

Контрпример


Проигрыш
Расходы на косенный вызов из vtable 

Контрпример
- поиск vtable - константное время


## Решение о применении
- раз в неделю добавляется подтип 
- стабильность и удобство приоритетнее производительности



- один новый подтип добавляется 1 раз в год
- критичны расходы (микросекунды) на динамическую диспетчеризацию



---

Пример в коде
Задача - выбор сериализатора
[Динамический выбор / Полиморфизм](../../concepts/src/main/java/org/example/polymorphism/SerializableDynamic.java)
[Статический выбор / НеПолиморфизм](../../concepts/src/main/java/org/example/polymorphism/SerializableStatic.java)


---

рассуждения на полях

полиморфизм
не процесс, т.к. процесс имеет начало, переходы, завершение
не механизм, т.к. механизмом может быть физический объект, каким не является полиморфизм
не свойство, т.к. может быть реализован, может быть не реализован
полиморфизм - результат использования интерфейсов и наследования? - интерфейсы и наследование - один из способов реализации полиморфизма
полиморфизм можно применять, можно не применять

есть код, который умеет рисовать Круг. Появляется задача рисовать Квадрат.
Без полиморфизма: в класс рисовальщика добавить метод рисования квадрата, с помощью if выбирать выполнение этого метода, если на вход передано "нарисуй квадрат"  
С полиморфизмом: добавить класс квадрата, переопределяющий метод рисования так, чтобы получился квадрат