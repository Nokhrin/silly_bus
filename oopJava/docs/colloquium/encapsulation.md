# Инкапсуляция

> private, protected... какая польза и как тестировать инкапсулированное поведение

инкапсуляция - методология защиты объекта с помощью сокрытия полей и реализации методов, дающих функционал из требований


## инструмент абстракции
если абстракция - это фундамент, нулевой уровень модели, то уровень 1 - инкапсуляция + [полиморфизм](polymorphism.md)

абстракция разделяет сущности на важные и неважные в контексте задачи
инкапсуляция скрывает реализацию, дает конкретный метод для конкретной задачи 


пример
дает конкретное решение - списать средства вместо получить баланс, посчитать, записать баланс


## проблема 1 - безопасность состояния
защита от изменения данных внешним кодом

механизм решения - скрыть поля -> запретить чтение и запись напрямую
в java доступ к полям управляется инструкциями уравней доступа public, private, package-private, protected

чтение и запись выполнять методами, объявленными в интерфейсе

кто, откуда, как обращается к данным - если доступ открыт - дорого разбираться


## проблема 2 - управляемость кодом

изменение требований -> экспоненциальный рост точек отказа

если есть 100500 методов в 100 модулях, которые работают с состоянием, то при изиенении требований,
например, множество значений поля (были все int, стали только >0), придется изменять логику 100500 методов в 100 модулях
ошибка в этой работе неизбежна, будет нежданный косяк

## проблема 3 - использование не по инструкции

определить поля и методы таким образом по принципу "что не разрешено, то запрещено" / белый список

## проблема 4 - надежность кода, ответственность программиста

### инкапсуляция + наследование реализации => наследование класса
хрупкость при изменении базового класса
изменится реализация родителя - может отвалиться наследник

пример
зависимость от типа значения при обращении напрямую

### инкапсуляция + наследование интерфейса => подтипизация
взаимодействие через контракт - методы
надежность 
локализация ответственности повышает надежность -
доступ разрешен только в специальных методах, 
в которых программист проверяет требования, логика защищена
программисту легче контролировать значения, состояние
